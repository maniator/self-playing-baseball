name: Copilot Setup Steps

permissions:
  contents: read

# This workflow sets up the Copilot coding agent's environment before it starts
# working on a task.  Steps here run BEFORE the firewall is enabled, so all
# network downloads (npm packages, Playwright browsers) must happen here.
#
# The job must be named `copilot-setup-steps` and triggered by `workflow_dispatch`.
# See: https://docs.github.com/en/copilot/customizing-copilot/customizing-the-development-environment-for-copilot-coding-agent

on:
  workflow_dispatch:

jobs:
  copilot-setup-steps:
    runs-on: ubuntu-latest
    # Use the same Playwright container as playwright-e2e.yml so that the
    # Copilot agent runs in an identical environment to CI — same fonts, system
    # libraries, and browser binaries (pre-installed at /ms-playwright in the
    # image). Visual snapshot baselines generated by the agent will match CI.
    container:
      image: mcr.microsoft.com/playwright:v1.58.2-noble

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Use Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: .nvmrc

      - name: Enable Corepack
        run: corepack enable

      - name: Install dependencies
        run: yarn install

      # Pre-build the app so `vite preview` (used by E2E tests) is ready to serve
      # immediately — the agent doesn't need to rebuild before running E2E tests.
      # Browser binaries are already pre-installed in the container image at
      # /ms-playwright (PLAYWRIGHT_BROWSERS_PATH), so no install step is needed.
      - name: Build app
        run: yarn build
